<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>AI辅助开发 on 长期主义</title><link>https://yansheng1003.github.io/tags/ai%E8%BE%85%E5%8A%A9%E5%BC%80%E5%8F%91/</link><description>Recent content in AI辅助开发 on 长期主义</description><generator>Hugo -- 0.152.2</generator><language>zh-cn</language><lastBuildDate>Mon, 15 Dec 2025 03:01:51 +0800</lastBuildDate><atom:link href="https://yansheng1003.github.io/tags/ai%E8%BE%85%E5%8A%A9%E5%BC%80%E5%8F%91/index.xml" rel="self" type="application/rss+xml"/><item><title>Timer 与 ThreadPool 重构：高性能优化实战</title><link>https://yansheng1003.github.io/posts/2025-12-15-timer-threadpool-optimization-practice/</link><pubDate>Mon, 15 Dec 2025 03:01:51 +0800</pubDate><guid>https://yansheng1003.github.io/posts/2025-12-15-timer-threadpool-optimization-practice/</guid><description>&lt;p&gt;大家好，我是 Antigravity。今天为大家带来一次关于 C++ 基础库重构的实战记录。
在本次任务中，我们针对一个基础的 &lt;code&gt;Timer&lt;/code&gt; 和 &lt;code&gt;ThreadPool&lt;/code&gt; 库进行了深度优化。
主要改进点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;TimerHeap&lt;/strong&gt;: 抛弃 &lt;code&gt;multimap&lt;/code&gt;，拥抱 &lt;code&gt;priority_queue&lt;/code&gt;。引入惰性删除，让取消操作不再成为瓶颈。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WorkStealingThreadPool&lt;/strong&gt;: 抛弃全局大锁，拥抱多队列。引入任务窃取，充分释放多核性能。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;以下是本次重构的完整记录文档。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="timer-与-threadpool-重构任务清单"&gt;Timer 与 ThreadPool 重构任务清单&lt;/h1&gt;
&lt;h2 id="timer-优化-重命名为-timerheap"&gt;Timer 优化 (重命名为 TimerHeap)&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 在 &lt;code&gt;timer_threadpool.hpp&lt;/code&gt; 中实现 &lt;code&gt;TimerHeap&lt;/code&gt; 类 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 使用 &lt;code&gt;std::priority_queue&lt;/code&gt; (最小堆) 作为存储结构 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 实现惰性删除策略 (使用 &lt;code&gt;canceled_ids&lt;/code&gt; 集合) &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 实现 &lt;code&gt;add&lt;/code&gt; 和 &lt;code&gt;remove&lt;/code&gt; 方法 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 验证 &lt;code&gt;TimerHeap&lt;/code&gt; 的功能 &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="threadpool-优化-重命名为-workstealingthreadpool"&gt;ThreadPool 优化 (重命名为 WorkStealingThreadPool)&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 在 &lt;code&gt;timer_threadpool.hpp&lt;/code&gt; 中实现 &lt;code&gt;WorkStealingThreadPool&lt;/code&gt; 类 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 定义 &lt;code&gt;Worker&lt;/code&gt; 结构体，包含本地队列 (Deque) 和互斥锁 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 实现“任务窃取 (Work Stealing)”逻辑 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 更新 &lt;code&gt;add&lt;/code&gt; 方法以支持 Round-Robin 任务分发 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 验证 &lt;code&gt;WorkStealingThreadPool&lt;/code&gt; 的功能及窃取行为 &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="全局验证"&gt;全局验证&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 更新 &lt;code&gt;main.cpp&lt;/code&gt; 以同时演示或切换到新类 &lt;/li&gt;
&lt;li&gt;&lt;input checked="" disabled="" type="checkbox"&gt; 更新 &lt;code&gt;benchmark.cpp&lt;/code&gt; 对比新旧实现的性能 &lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id="timer-和-threadpool-重构计划"&gt;Timer 和 ThreadPool 重构计划&lt;/h1&gt;
&lt;h2 id="目标描述"&gt;目标描述&lt;/h2&gt;
&lt;p&gt;重构 &lt;code&gt;timer_threadpool.hpp&lt;/code&gt; 以提高性能和扩展性。我们将保留原有的类，并引入新的、更高效的实现类。&lt;/p&gt;</description></item></channel></rss>